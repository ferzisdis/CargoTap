# AI Assistant Context for CargoTap Project

## Project Overview
A Rust typing game using Vulkan for rendering. Users type code and get real-time visual feedback.

## Key Architecture Components

### Core State Management
- **CodeState** (`src/code_state.rs`): Manages `printed_code` (typed) and `current_code` (remaining)
- **Config** (`src/config.rs`): TOML-based configuration system
- **InputHandler** (`src/input.rs`): Character-by-character validation

### Rendering System (Vulkan)
- **VulkanRenderer** (`src/renderer/mod.rs`): Main renderer with ApplicationHandler
- **TextSystem** (`src/text.rs`): Font rendering with per-character colors, manages atlas/texture
- Modular: `vulkan_init.rs`, `swapchain.rs`, `pipeline.rs`
- Uses Vulkan 1.3 dynamic rendering

### Important Patterns
- Text rendered via ColoredText with RGBA per character: `[r, g, b, a]` where values are 0.0-1.0
- Scroll offset changes VIEW only, not typing position
- Backspace moves chars from `printed_code` back to `current_code`

## Common Tasks

### Adding Config Options
1. Update `Config` struct in `src/config.rs`
2. Add to `generate_default_config_with_comments()` with inline doc
3. Update `load()` method if needed

### Text Rendering Changes
- Modify `TextSystem` in `src/text.rs`
- Atlas regeneration happens in `update_text_with_settings()`
- Vertex buffer format: position (vec2) + color (vec4)

### Vulkan Pipeline Changes
- Shaders in `src/renderer/pipeline.rs` (inline with vulkano macro)
- Two pipelines: geometry (triangle) and text
- Check `create_text_pipeline()` for text-specific setup

## Dependencies to Remember
- `vulkano` - Vulkan wrapper
- `winit` - Window/events
- `ab_glyph` - Font rasterization
- `serde`/`toml` - Config serialization

## Code Style
- Use `Result` and `anyhow::Error` for error handling
- Prefer `Arc<T>` for shared Vulkan resources
- Config options should have descriptive comments in generated TOML

## Documentation Rules
- **DO**: Update this file when learning new patterns/gotchas
- **DO**: Keep `src/renderer/README.md` updated if architecture changes
- **DO NOT**: Create usage guides, summaries, changelogs, or user-facing docs unless explicitly asked
- **DO NOT**: Update main README.md unless major user-facing feature added AND user requests it

## Known Gotchas
- Scrolling is view-only, doesn't affect typing position
- Text atlas needs regeneration when text/settings change
- Swapchain recreation needed on window resize
- Font must be monospace for code alignment

## Files to Check When...
- **Config issues**: `src/config.rs`, `config.toml`
- **Rendering problems**: `src/renderer/mod.rs`, `src/text.rs`
- **Input/typing logic**: `src/input.rs`, `src/code_state.rs`
- **Pipeline/shader issues**: `src/renderer/pipeline.rs`
